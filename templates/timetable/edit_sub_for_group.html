    {% extends 'base.html' %}
    {% block title %}Home{% endblock %}

    {% block content %}
        <!-- <div class="page-content--bgf7"> -->
        <section class="timetable-section">
            <div class="row m-3 p-3">
                <div class="col-4"></div>
                <div class="col-4">
                    <div likes="42" id="app" data-app>
                        <v-card class = "mb-4">
                            <v-card-title>Группа {{group.group_info}}</v-card-title>
                             <v-divider></v-divider>

                            <v-list-item
                                    v-for="(item, index) in info"
                                    :key="item.lesson.name"
                            >

                            <v-list-item-content>
                                <v-list-item-title v-text="item.lesson.name"></v-list-item-title>
                            </v-list-item-content>

                            <v-list-item-action>
                                <v-btn @click="del_item(index)" icon>
                                    <v-icon color="grey lighten-1">mdi-close</v-icon>
                                </v-btn>
                            </v-list-item-action>
                        </v-list-item>

                        </v-card>
                        <v-autocomplete
                                v-model="model"
                                :items="items"
                                :loading="isLoading"
                                :search-input.sync="search"
                                color="white"
                                hide-no-data
                                hide-selected
                                item-text="name"
                                item-value="name"
                                placeholder="Добавить новый предмет"
                                return-object
                        ></v-autocomplete>
                    <v-btn @click="save_item">
                       Сохранить
                    </v-btn>
                    </div>


                </div>
                <div class="col-4"></div>
            </div>


        </section>

    {% endblock %}
    {% block script %}
        <script>

            new window.Vue({
                el: '#app',
                vuetify: new Vuetify(),
                delimiters: ['[[', ']]'],
                components: {
                    {#'app-world': window.httpVueLoader('/js/components/AppWorld.vue')#}
                },
                props: ['likes'],
                data() {

                    return {
                        test: "asdasdasdasdasdasd",
                        info: [],
                        descriptionLimit: 60,
                          entries: [],
                          isLoading: false,
                          model: null,
                          search: null,
                    }
                },
                mounted() {
                    axios
                        .get('http://127.0.0.1:5000/api/tt/lessons_for_group/{{ group.id }}')
                        .then(response => (this.info = response.data));
                },
                methods: {
                    del_item(event) {
                        this.info.splice(event, 1)
                    },
                     async save_item(){
                         const csrftoken = Cookies.get('csrftoken')
                         await axios
                            .post('http://127.0.0.1:5000/api/tt/lessons_for_group/{{ group.id }}',
                                {data: this.info},
                                {
                                    headers: {
                                        'X-CSRFToken': csrftoken,
                                    }
                                },
                            )
                            .then(response => (this.info = response.data));
                    }
                },
                computed: {
                    fields() {
                        if (!this.model) return []
                        return Object.keys(this.model).map(key => {
                            return {
                                key,
                                value: this.model[key] || 'n/a',
                            }
                        })
                    },
                    items() {
                        return this.entries.map(entry => {
                            const name = entry.name.length > this.descriptionLimit
                                ? entry.name.slice(0, this.descriptionLimit) + '...'
                                : entry.name

                            return Object.assign({}, entry, {name})
                        })
                    },
                },

                watch: {
                    model() {
                        console.log(this.model)
                      this.info.push({group_info: 13, lesson: {id: this.model.id, name: this.model.name }})
                        console.log(this.info)
                    },
                    search(val) {
                        // Items have already been loaded
                        if (this.items.length > 0) return

                        // Items have already been requested
                        if (this.isLoading) return

                        this.isLoading = true

                        // Lazily load input items
                        fetch('http://127.0.0.1:5000/api/tt/lessons')
                            .then(res => res.json())
                            .then(res => {
                                const {count, entries} = res
                                this.count = count
                                this.entries = entries
                                console.log(res)
                            })
                            .catch(err => {
                                console.log(err)
                            })
                            .finally(() => (this.isLoading = false))
                    },
                },
            })
        </script>
        {#    <script>#}
        {#        $("#close_item").click(function (event) {#}
        {#            console.log(this.parentElement);#}
        {#            this.parentElement.remove();#}
        {#        });#}
        {#    </script>#}
    {% endblock %}